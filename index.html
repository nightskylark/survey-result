<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Результат теста</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    input, button { font-size: 1rem; padding: 0.5em; }
    #chart { max-width: 500px; margin-top: 2em; }
    #sector { margin-top: 1em; font-weight: bold; font-size: 1.2em; }
  </style>
</head>
<body>

  <h1>Результат теста</h1>
  <input type="text" id="resultId" placeholder="Введите идентификатор результата" />
  <button onclick="loadResult()">Показать</button>

  <canvas id="chart" width="500" height="500"></canvas>
  <div id="sector"></div>
  <div id="description"></div>

  <script>
    const testId = 'k6j7qvfogh24k';
    const token = 'c9b05eaf213d441a9fdc88baadeeb55c';

    async function loadResult() {
      const resultId = document.getElementById('resultId').value.trim();
      if (!resultId) return alert("Введите ID результата");

      try {
        const response = await fetch(`https://api.onlinetestpad.com/v1/tests/${testId}/results/${resultId}`, {
          headers: { 'Access-Token': token }
        });
        if (!response.ok) throw new Error("Ошибка получения данных");

        const data = await response.json();
        const x = data.x; // оптимизм
        const y = data.y; // активность
        const text = data.description;

        drawChart(x, y);
        document.getElementById("sector").innerText = "Сектор: " + determineSector(x, y);
        document.getElementById("description").innerText = text;

      } catch (err) {
        alert("Ошибка: " + err.message);
      }
    }

    function determineSector(x, y) {
      if (x >= 15 && x <= 19 && y >= 17 && y <= 24) return "Реалисты";
      if (x >= 20 && x <= 24 && y >= 25 && y <= 36) return "Энтузиасты";
      if (x >= 6 && x <= 14 && y >= 25 && y <= 36) return "Негативисты";
      if (x >= 20 && x <= 24 && y >= 9 && y <= 16) return "Лентяи";
      if (x >= 6 && x <= 14 && y >= 9 && y <= 16) return "Жертвы";
      return "Пограничное значение";
    }

    let chart;

    function drawChart(x, y) {
      const ctx = document.getElementById('chart').getContext('2d');
      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'scatter',
        data: {
          datasets: [{
            label: 'Результат',
            data: [{ x: x, y: y }],
            pointBackgroundColor: 'red',
            pointRadius: 8,
          }]
        },
        options: {
          responsive: false,
          scales: {
            x: {
              title: { display: true, text: 'Оптимизм' },
              min: 6, max: 24,
              ticks: { stepSize: 1 }
            },
            y: {
              title: { display: true, text: 'Активность' },
              min: 9, max: 36,
              ticks: { stepSize: 1 }
            }
          }
        }
      });
    }
  </script>

</body>
</html>
